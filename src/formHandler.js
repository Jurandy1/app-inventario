async function handleLiveInventorySubmit(e){e.preventDefault();const t={unidade:document.getElementById("live-unidade").value.trim(),item:document.getElementById("live-item").value.trim(),tombo:document.getElementById("live-tombo").value.trim(),local:document.getElementById("live-local").value.trim(),estado:document.getElementById("live-estado").value};if(!t.tombo||!t.item)return void Notiflix.Notify.warning('Os campos "Tombo" e "Item" são obrigatórios.');if(state.liveInventory.some(e=>e.tombo===t.tombo))return void Notiflix.Notify.failure(`O item com o tombo "${t.tombo}" já foi adicionado.`);Notiflix.Loading.standard("Salvando item na nuvem...");try{const a=await apiCall({action:"ADD_LIVE_ITEM",payload:t});"success"===a.status?(state.liveInventory.push(t),renderLiveInventory(),e.target.reset(),document.getElementById("live-unidade").focus(),Notiflix.Notify.success("Item salvo na nuvem!")):a.status,"error"===a.status?Notiflix.Notify.failure(`Erro do servidor: ${a.message}`):Notiflix.Notify.failure("Erro desconhecido ao salvar.")}catch(e){console.error("Erro ao salvar item:",e),Notiflix.Notify.failure(`Falha ao salvar o item: ${e.message}`)}finally{Notiflix.Loading.remove()}}function handleDeleteLiveItem(e){const t=e.target.dataset.tombo;Notiflix.Confirm.show("Confirmar Exclusão",`Você tem certeza que deseja excluir o item com tombo "${t}"? Esta ação não pode ser desfeita.`,"Sim, Excluir","Cancelar",async()=>{Notiflix.Loading.standard("Excluindo item da nuvem...");try{const e=await apiCall({action:"DELETE_LIVE_ITEM",payload:{tombo:t}});if("success"===e.status)state.liveInventory=state.liveInventory.filter(e=>e.tombo!==t),renderLiveInventory(),Notiflix.Notify.success("Item excluído com sucesso!");else throw new Error(e.message||"Erro ao excluir no servidor")}catch(e){console.error("Erro ao excluir item:",e),Notiflix.Notify.failure(`Falha ao excluir o item: ${e.message}`)}finally{Notiflix.Loading.remove()}})}function handleFileInput(e,t){const a=e.target.files[0];if(!a)return;const s=document.getElementById(`${t}-report-status`);s.textContent=`Carregando "${a.name}"...`,s.classList.remove("text-green-600","text-red-600"),Notiflix.Loading.standard("Processando arquivo CSV...");const i="system"===t?["TOMBAMENTO","Cadastro","Descricao","TipoEntrada","NF","Ativo","SubStatus","NomeFornecedor","Responsavel","DataUltimoMovimento","ValorNF","Status"]:["UNIDADE","Item","Tombo","Local","EstadodeConservacao"];parseCsvFile(a,i,a=>{a.error?(s.textContent=`Erro: ${a.error}`,s.classList.add("text-red-600"),Notiflix.Loading.remove(),Notiflix.Notify.failure(`Erro ao processar o arquivo: ${a.error}`)):("system"===t?state.systemReport=a.data:state.inventory=a.data,s.textContent=`${a.data.length} registros carregados de "${e.target.files[0].name}".`,s.classList.add("text-green-600"),Notiflix.Loading.remove(),Notiflix.Notify.success("Arquivo processado com sucesso!"))})}
